# Floorball LLM Analysis - Application Configuration
# Copy this file to config.yaml and customize for your needs
# 
# This file contains APPLICATION SETTINGS (non-sensitive)
# API keys and secrets go in .env file (never commit to git)

# ============================================================
# Backend Configuration
# ============================================================

# Which LLM backend to use
# Options: simulated, openai, gemini, anthropic, huggingface, ollama, perplexity
llm_backend: simulated

# Sport type for analysis
# Options: floorball, hockey, soccer
sport: floorball

# ============================================================
# Model Selection (per backend)
# ============================================================

# OpenAI model selection
# Options: gpt-4o, gpt-4o-mini, gpt-4-turbo, gpt-5-mini-2025-08-07
openai_model: gpt-4o-mini

# OpenAI Rate Limits (Tokens Per Minute / Requests Per Minute)
# Used to automatically calculate optimal chunk delays
# Free tier limits (update these based on your actual plan):
openai_rate_limit_tpm: 500000  # Tokens per minute limit
openai_rate_limit_rpm: 500     # Requests per minute limit

# Anthropic model selection
# Options: claude-3-5-sonnet-20241022, claude-3-opus-20240229
# anthropic_model: claude-3-5-sonnet-20241022

# Anthropic Rate Limits
# anthropic_rate_limit_tpm: 80000
# anthropic_rate_limit_rpm: 50

# HuggingFace model selection
huggingface_model: meta-llama/Llama-3.2-3B-Instruct

# Gemini model selection
# Options: gemini-1.5-pro, gemini-1.5-flash, gemini-1.5-flash-8b
# Note: Don't use -latest suffix, just the base model name
# gemini_model: gemini-2.5-flash

# Perplexity model selection
# Options: sonar, sonar-pro, sonar-reasoning, sonar-reasoning-pro
# Note: sonar models support online search and vision capabilities
# perplexity_model: sonar

# Ollama configuration
ollama_endpoint: http://localhost:11434
ollama_model: llama3.2

# ============================================================
# Processing Settings
# ============================================================

# Output directory for generated clips
clip_output_dir: clips

# Enable LLM response caching (faster, saves API costs)
cache_enabled: true
cache_dir: .cache

# Parallel processing for batch operations
parallel_processing: false
max_workers: 4

# Goal reinforcement and training hooks
goal_refinement_enabled: true
goal_refinement_attempts: 2
goal_refinement_window: 2.5
goal_refinement_interval: 0.25
goal_annotation_enabled: false
goal_annotation_dir: annotations/goals
goal_annotation_threshold: 0.7

# ============================================================
# Rate Limit Settings (for chunk parallel processing)
# ============================================================
# These settings control how many parallel workers process video chunks
# and how to handle API rate limit errors (HTTP 429)

# OpenAI Rate Limits:
# - gpt-4o: 30,000 TPM / 500 RPM (Tokens/Requests Per Minute)
# - gpt-4o-mini: 500,000 TPM / 500 RPM
# - gpt-5-mini: 500,000 TPM / 500 RPM
# - gpt-5-nano: 200,000 TPM / 500 RPM
# 
# AUTO-CALCULATED: Based on openai_rate_limit_rpm setting above
# Formula: max_workers = (RPM / 15) * 0.8
#   - RPM / 15 = chunks per minute (each worker processes ~15 chunks/min)
#   - * 0.8 = use 80% capacity for safety margin
# 
# Examples:
#   500 RPM → (500/15)*0.8 = 26 workers
#   200 RPM → (200/15)*0.8 = 10 workers
#   50 RPM → (50/15)*0.8 = 2 workers
# 
# You can override by uncommenting and setting a specific value:
# max_workers_openai: 2  # Optional override; default auto-calculates based on RPM (26 at 500 RPM)

# Gemini Rate Limits:
# - Free tier: 15 RPM (requests per minute)
# - Pay-as-you-go: Higher limits, varies by model
# Recommendation: Use 4-6 workers for paid tier, 2 for free tier
max_workers_gemini: 4

# How long to wait when hitting rate limits (seconds)
# OpenAI typically suggests waiting 30-60s after 429 error
rate_limit_retry_delay: 40.0

# Maximum retry attempts for rate-limited requests
# After this many retries, the chunk will be skipped
rate_limit_max_retries: 3

# ============================================================
# Retry & Timeout Settings (general API errors)
# ============================================================

max_retries: 3
retry_delay: 1.0
timeout: 60.0

# ============================================================
# Logging
# ============================================================

log_level: INFO  # Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
log_file: logs/floorball_llm.log  # Log file path (relative to project root)

# ============================================================
# Sport Presets - Customize event detection per sport
# ============================================================
# You can add new sports or modify existing ones here

sport_presets:
  floorball:
    name: floorball
    event_types:
      - goal
      - assist
      - shot
      - save
      - penalty
      - timeout
      - unforced error
    clip_padding_before: 10
    clip_padding_after: 5
    time_dedup_window: 5.0
    frame_interval: 0.5  # Extract 1 frame every 0.5 seconds (fast-paced sport, high sampling rate)
    max_frames: 50  # Larger chunks to reduce API calls and stay within rate limits
    hint: "Look for: ball crossing the goal line, net shaking, referee pointing to center, teammates celebrating near the crease, goalkeeper reactions, and players raising arms. Ignore scoreboard-only changes unless you also see the goal."
    keywords:
      goal: [goal, score, scores, net, goal light, celebrate, scoreboard]
      assist: [assist, pass, setup]
      shot: [shot, shoots, attempt]
      save: [save, saves, stopped, block]
      penalty: [penalty, foul, 2 minutes, bench]
      timeout: [timeout, time out, break]
  
  hockey:
    name: hockey
    event_types:
      - goal
      - assist
      - shot
      - save
      - penalty
      - icing
      - offside
    clip_padding_before: 6
    clip_padding_after: 10
    time_dedup_window: 5.0
    frame_interval: 10.0  # Standard sampling
    max_frames: 20
    hint: "Look for: puck crossing the goal line, red goal light, referee waving, player celebrations, and keeper reactions. Avoid relying on scoreboard flashes without the goal motion."
    keywords:
      goal: [goal, score, scores, goal light, net]
      penalty: [penalty, 2 minutes, 5 minutes]
      icing: [icing]
      offside: [offside]
  
  soccer:
    name: soccer
    event_types:
      - goal
      - assist
      - shot
      - save
      - corner
      - freekick
      - penalty
      - yellow_card
      - red_card
    clip_padding_before: 8
    clip_padding_after: 12
    time_dedup_window: 5.0
    frame_interval: 15.0  # Sample less frequently for slower-paced sport
    max_frames: 15  # Fewer frames needed
    hint: "Look for: ball crossing the goal line, net rippling, players celebrating, referee signals, and goalkeeper pushes. Scoreboard updates alone should not trigger a goal."
    keywords:
      goal: [goal, score, net, celebrate]
      corner: [corner, corner kick]
      yellow_card: [yellow card, booking]
      red_card: [red card, sent off]
